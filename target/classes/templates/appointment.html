<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <title>Add Appointment</title>
    <style>
    * {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: "Lato", sans-serif;
		}
        body {
            background-image: url("https://live.staticflickr.com/65535/52939897827_f16c54ba56_z.jpg");
            background-size: cover;
            background-position: center center;
            font-family: Arial, sans-serif;
        }

        h1 {
            text-align: center;
            padding-top: 10px;
            font-size: 37px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            color:#000080;
        }

        h2{
            text-align: center;
                        margin-bottom: 10px;
color:#000080;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.3);
}
header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			background-color: #00337f;
			color: #fff;
			padding: 6px;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
		}
		.logo img {
			width: 100px;
			height: auto;
		}
		nav ul {
			list-style: none;
			display: flex;
			flex-direction: row;
			align-items: center;
		}
		nav ul li {
			margin-right: 20px;
		}
		nav ul li a {
			color: #fff;
			text-decoration: none;
			text-transform: uppercase;
			font-weight: bold;
		}
		nav ul li a:hover {
			color: #ccc;
		}
        form {
            max-width: 500px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 20px;
            margin-bottom: 10px;
            font-weight: bold;
            color: #3c3c3c;
        }

        input[type="date
"],
input[type="time"],
select {
border: none;
font-size: 18px;
padding: 10px;
margin-bottom: 20px;
border-radius: 5px;
box-shadow: inset 0px 0px 5px rgba(0,0,0,0.2);
}    input[type="submit"] {
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        padding: 10px;
        font-size: 20px;
        font-weight: bold;
        margin-top: 20px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    input[type="submit"]:hover {
        background-color: #0063cc;
    }

    select {
        width: 100%;
    }

    .form-container {
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 10px;
        padding: 50px;
        margin: 0 auto;
        box-shadow: 0px 0px 10px rgba(0,0,0,0.3);
        margin-top: 100px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        max-width: 500px;
    }

    .form-container h2 {
        font-size: 30px;
        margin-bottom: 30px;
        color: #007bff;
          text-align: center;

        text-shadow: 2px 2px 5px rgba(0,0,0,0.3);
    }

    .transparent-background {
        background-color: rgba(0, 0, 0, 0.4);
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    @media (max-width: 768px) {
        .form-container {
            padding: 30px;
        }
    }

    @media (max-width: 500px) {
        .form-container {
            padding: 20px;
            margin-top: 50px;
        }
    }


    </style>
    <title>Make an Appointment</title>
    <script>
        function updateDoctorList() {
            var departmentSelect = document.getElementById("department");
            var selectedDepartment = departmentSelect.value;
            var doctorSelect = document.getElementById("doctor");
            doctorSelect.innerHTML = ""; // Elimină toate opțiunile existente înainte de a adăuga noile opțiuni

            // Adaugă o opțiune "Selectați un doctor"
            var selectOption = document.createElement("option");
            selectOption.value = "";
            selectOption.text = "Selectați un doctor";
            doctorSelect.appendChild(selectOption);

            switch (selectedDepartment) {
                case "Cardiology":
                    addDoctorsToSelect([
                        { id: 21, name: "Dr. John Smith" },
                        { id: 25, name: "Dr. James Wilson" },
                        { id: 29, name: "Dr. Robert Baker" }
                    ]);
                    break;c
                case "Dermatology":
                    addDoctorsToSelect([
                        { id: 22, name: "Dr. Sarah Brown" },
                        { id: 26, name: "Dr. Jessica Clark" },
                        { id:30, name: "Dr. Samantha Lee" }
                    ]);
                    break;
                case "Endocrinology":
                    addDoctorsToSelect([
                        { id: 23, name: "Dr. David Johnson" },
                        { id: 27, name: "Dr. Michael Taylor" }
                    ]);
                    break;
                case "Gastroenterology":
                    addDoctorsToSelect([
                        { id: 24, name: "Dr. Michael Taylor" },
                        { id: 28, name: "Dr. Elizabeth Martinez" }
                    ]);
                    break;
            }
        }

        function addDoctorsToSelect(doctorList) {
            var doctorSelect = document.getElementById("doctor");
            doctorList.forEach(function(doctor) {
                var option = document.createElement("option");
                option.value = doctor.id;
                option.text = doctor.name;
                doctorSelect.appendChild(option);
            });
        }

function validateForm() {
    var dateInput = document.getElementById("date");
    var startTimeInput = document.getElementById("startTime");
    var endTimeInput = document.getElementById("endTime");

    // Verifică completitudinea datelor
    if (startTimeInput.value === "" || endTimeInput.value === "") {
        alert("Vă rugăm să completați orele de început și sfârșit.");
        return false;
    }

    // Verifică formatul datei
    var datePattern = /^\d{4}-\d{2}-\d{2}$/;
    if (!datePattern.test(dateInput.value)) {
        alert("Data nu este în formatul corect. Utilizați formatul YYYY-MM-DD.");
        return false;
    }

   var dateArray = dateInput.value.split(".");
var day = parseInt(dateArray[0]);
var month = parseInt(dateArray[1]);
var year = parseInt(dateArray[2]);
var formattedDate = year + "-" + padNumber(month) + "-" + padNumber(day);
var date = new Date(formattedDate);

    // Verifică formatul timpului de început
    var timePattern = /^\d{2}:\d{2}$/;
    if (!timePattern.test(startTimeInput.value)) {
        alert("Ora de început nu este în formatul corect. Utilizați formatul HH:MM.");
        return false;
    }

    // Verifică formatul timpului de sfârșit
    if (!timePattern.test(endTimeInput.value)) {
        alert("Ora de sfârșit nu este în formatul corect. Utilizați formatul HH:MM.");
        return false;
    }
   // Converteste timpul de început și sfârșit în obiecte java.sql.Time
var startHour = parseInt(startTimeArray[0]);
var startMinute = parseInt(startTimeArray[1]);
var startTimeString = startHour.toString().padStart(2, '0') + ':' + startMinute.toString().padStart(2, '0') + ':01';
var startTime = java.sql.Time.valueOf(startTimeString);


var endHour = parseInt(endTimeArray[0]);
var endMinute = parseInt(endTimeArray[1]);

var endTimeString = endHour.toString().padStart(2, '0') + ':' + endMinute.toString().padStart(2, '0') + ':01';
var endTime = java.sql.Time.valueOf(endTimeString);

// Seteaza valorile timpului convertit in obiectul appointment
appointment.startTime = startTime;
appointment.endTime = endTime;

    return true;
}
function padNumber(number) {
  return number < 10 ? "0" + number : number;
}


    </script>
</head>
<body>
<header>
    <div class="logo">
        <img src="https://live.staticflickr.com/65535/52938325014_23e12349b1.jpg" alt="NYC Health + Hospitals">
    </div>
    <nav>
        <ul>
            <li><a href="../pacient_menu">Home</a></li>
            <li><a href="../pacient_menu#about">About Us</a></li>
            <li><a href="../pacient_menu/find_doctor">Find a Doctor</a></li>
            <li><a href="../pacient_menu#contacts">Contact Us</a></li>
        </ul>
    </nav>
</header>
<h1>Make an Appointment</h1>
<div class="transparent-background">
    <div class="form-container">
        <h2>Choose the convenient day and time</h2>
        <form method="post" action="/users/pacient_menu/appointment" onsubmit="return validateForm()">
            <label for="date">Data:</label>
            <input type="date" id="date" name="date">
            <label for="startTime">Ora de început:</label>
            <input type="time" id="startTime" name="startTime">
            <label for="endTime">Ora de sfârșit:</label>
            <input type="time" id="endTime" name="endTime">
            <label for="department">Departament:</label>
            <select id="department" name="department" onchange="updateDoctorList()">
                <option value="">Selectați un departament</option>
                <option value="Cardiology">Cardiology</option>
                <option value="Dermatology">Dermatology</option>
                <option value="Endocrinology">Endocrinology</option>
                <option value="Gastroenterology">Gastroenterology</option>
            </select>
            <label for="doctor">Doctor:</label>
            <select id="doctor" name="doctor">
                <option value="">Selectați un doctor</option>
            </select>
            <button type="submit">Trimiteți programarea</button>
            <div th:if="${session.eroare}" class="my-3">
                <p class="text-danger">Invalid date and time</p>
            </div>


        </form>
    </div>
</div>

</body>
</html>